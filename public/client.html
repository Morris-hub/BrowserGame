<!DOCTYPE html>
<html>
  <head>
    <title>Multiplayer</title>
  </head>
  <body>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      //import { Animation } from "./animation.js";
      var socket = io();
      var cube = null;
      var clientId = null;

      // Client-ID empfangen
      socket.on("clientId", function(receivedClientId) {
        clientId = receivedClientId;
        displayclientID(clientId);
        body();
        //textBox();
        console.log("Meine Client-ID:", clientId);
      });

      // Empfange die init-Nachricht vom Server
      socket.on("init", function(cubes) {
        // Erstelle Cube-Elemente für jeden verbundenen Client
        for (var clientID in cubes) {
          createCubeElement(clientID);
          console.log("liste " + clientID);
        }
      });

      //Movement Player
      document.addEventListener("keydown", function(event) {
        var keyCode = event.keyCode;
        var currentPosition = getCubePosition();
        const speed = 25;

        if (keyCode === 37) {
          // Bewege nach links
          currentPosition.x -= speed;
        } else if (keyCode === 38) {
          // Bewege nach oben
          currentPosition.y -= speed;
        } else if (keyCode === 39) {
          // Bewege nach rechts
          currentPosition.x += speed;
        } else if (keyCode === 40) {
          // Bewege nach unten
          currentPosition.y += speed;
        }

        // Senden Sie den aktuellen Cube-Status an den Server
        socket.emit("update-cube", currentPosition);
      });

      socket.on("update-cube", function(position) {
        // Überprüfe, ob die Socket-ID mit der aktuellen Socket-ID übereinstimmt
        if (position.clientId === clientId) {
          updateCubePosition(position);
        }
      });

      // Aktualisiere die Position des Cube-Elements basierend auf den empfangenen Daten
      socket.on("update-cube", function(position) {
        var cubeElement = document.getElementById(position.clientId);
        if (cubeElement) {
          cubeElement.style.left = position.x + "px";
          cubeElement.style.top = position.y + "px";
        }
      });

      //                                                    Funktionen
      // Funktion, um die Position des Cube-Elements zu aktualisieren
      function updateCubePosition(position) {
        cube.style.left = position.x + "px";
        cube.style.top = position.y + "px";
      }

      // Funktion, um die aktuelle Position des Cube-Elements zu erhalten
      function getCubePosition() {
        return {
          clientId: clientId,
          x: cube.offsetLeft,
          y: cube.offsetTop,
        };
      }

      function createCubeElement(clientId) {
        var newCube = document.createElement("div");
        newCube.id = clientId;
        newCube.style.width = "30px";
        newCube.style.height = "30px";
        newCube.style.left = "300px";
        newCube.style.top = "700px";
        newCube.style.backgroundColor = "pink";
        newCube.style.position = "absolute";
        newCube.style.transition = "all 0.2s";
        cube = document.body.appendChild(newCube);
      }

      function displaySocketID() {
        var socketIdElement = document.createElement("div");
        socketIdElement.id = "socket-id";
        socketIdElement.textContent = "Socket ID: " + socket.id;
        document.body.appendChild(socketIdElement);
      }

      function displayclientID(clientId) {
        var clientIdElement = document.createElement("div");
        clientIdElement.id = "client-id";
        clientIdElement.textContent = "Client ID: " + clientId;
        clientIdElement.style.fontFamily = "Arial, sans-serif";
        clientIdElement.style.fontSize = "14px";
        clientIdElement.style.color = "white";
        clientIdElement.style.position = "absolute";
        clientIdElement.style.top = "10px";
        clientIdElement.style.left = "10px";
        document.body.appendChild(clientIdElement);
      }

      function textBox() {
        var textBox = document.createElement("div");
        textBox.id = "box";
        textBox.style.width = "200px";
        textBox.style.height = "500px";
        textBox.style.left = "50px";
        textBox.style.top = "50px";
        textBox.style.backgroundColor = "black";
        textBox.style.border = "3px solid #EDC04E";
        textBox.style.borderRadius = "3px";
        textBox.style.position = "absolute";
        document.body.appendChild(textBox);
      }
      function box() {
        var newCube = document.createElement("div");
        newCube.id = "box";
        newCube.style.width = "30px";
        newCube.style.height = "30px";
        newCube.style.left = "300px";
        newCube.style.top = "700px";
        newCube.style.backgroundColor = "#ed3318";
        newCube.style.border = "2px solid black";
        newCube.style.boxShadow = "-5px 5px 0px black";
        newCube.style.position = "absolute";
        newCube.style.transition = "all 0.2s";
        cube = document.body.appendChild(newCube);
      }

      function body() {
        const body = document.body.style;
        body.backgroundColor = "white";
        body.margin = "0";
        body.padding = "0";
        body.overflow = "hidden";
      }

      function playground() {
        const playground = document.createElement("div");
        playground.id = "playground";
        playground.style.width = "100%";
        playground.style.height = height + "px";
        playground.style.backgroundColor = "white";
        document.body.appendChild(playground);
      }
    </script>
  </body>
</html>
