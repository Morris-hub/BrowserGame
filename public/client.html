<!DOCTYPE html>
<html>
  <head>
    <title>Multiplayer</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=VT323&display=swap"
    />
    <script src="./framework/Player.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./framework/UI.js"></script>
    <script src="./framework/Enemy.js"></script>
  </head>
  <body>
    <!-- <script src="./Player.js"></script> -->
    <script>
      var socket = io();
      var cube = null;
      var clientId = null;
      var keyPressCount = 0;
      const ui = new UI();
      const enemy = new Enemy();
      const player = new Player();
      DivElement = null;

      const text =
        "Hello World \n" + "This is a Example for an Multiplayer Game \n";
      // Client-ID empfangen
      socket.on("clientId", function(receivedClientId) {
        clientId = receivedClientId;
        displayclientID(clientId);
        ui.healthbar();
        enemy.createEnemy();
        enemy.moveRandom();
        const div = document.getElementById("enemy");

        var interval = setInterval(function() {
          // Hier kommt der Code für deine Funktion
          var pos_x = getRandomIntInclusive(1, 820);
          var pos_y = getRandomIntInclusive(1, 1080);
          enemy.moveDivToCoordinates(div, pos_x , pos_y);
          console.log("Die Funktion wird alle 3 Sekunden aufgerufen.");
        }, 3000);

        // Stoppt das Intervall nach 10 Sekunden
        setTimeout(function() {
          clearInterval(interval);
          console.log("Das Intervall wurde gestoppt.");
        }, 10000);

        body();
        button();
        //textBox();
        console.log("Meine Client-ID:", clientId);
      });

      // Empfange die init-Nachricht vom Server
      socket.on("init", function(cubes) {
        // Erstelle Cube-Elemente für jeden verbundenen Client
        for (var clientID in cubes) {
          createPlayer(clientID);
          console.log("liste " + clientID);
        }
      });

     player.move();

      //Movement Player
   /*   document.addEventListener("keydown", function(event) {
        var keyCode = event.keyCode;
        var currentPosition = getCubePosition();
        const speed = 25;

        if (keyCode === 37) {
          // Bewege nach links
          currentPosition.x -= speed;
          player.checkCollision();
        } else if (keyCode === 38) {
          // Bewege nach oben
          currentPosition.y -= speed;
          //checkCollision(enemy);
        } else if (keyCode === 39) {
          // Bewege nach rechts
          currentPosition.x += speed;
          //checkCollision(enemy);
        } else if (keyCode === 40) {
          // Bewege nach unten
          currentPosition.y += speed;
        } else if (keyCode === 49) {
          ui.handler(ui.retroBox);
        }

        // Senden Sie den aktuellen Cube-Status an den Server
        socket.emit("update-cube", currentPosition);
      });
*/
      socket.on("update-cube", function(position) {
        // Überprüfe, ob die Socket-ID mit der aktuellen Socket-ID übereinstimmt
        if (position.clientId === clientId) {
          updateCubePosition(position);
        }
      });

      // Aktualisiere die Position des Cube-Elements basierend auf den empfangenen Daten
      socket.on("update-cube", function(position) {
        var cubeElement = document.getElementById(position.clientId);
        if (cubeElement) {
          cubeElement.style.left = position.x + "px";
          cubeElement.style.top = position.y + "px";
        }
      });

      //                                                    Funktionen
      // Funktion, um die Position des Cube-Elements zu aktualisieren
      function updateCubePosition(position) {
        cube.style.left = position.x + "px";
        cube.style.top = position.y + "px";
      }

      // Funktion, um die aktuelle Position des Cube-Elements zu erhalten
      function getCubePosition() {
        return {
          clientId: clientId,
          x: cube.offsetLeft,
          y: cube.offsetTop,
        };
      }

      function createPlayer(clientId) {
        const player_color_1 = "#A2D2F0";
        const player_color_2 = "#ed3318";
        var newCube = document.createElement("div");
        newCube.id = clientId;
        newCube.className = "player";
        newCube.style.width = "30px";
        newCube.style.height = "30px";
        newCube.style.left = "50%";
        newCube.style.top = "50%";
        newCube.style.backgroundColor = player_color_2;
        newCube.style.border = "2px solid black";
        newCube.style.boxShadow = "-5px 5px 0px black";
        newCube.style.position = "absolute";
        newCube.style.transition = "all 0.2s";
        cube = document.body.appendChild(newCube);
      }

      function healthbar(healtstatus = "100") {
        var healthbar = document.createElement("div");
        healthbar.id = "healthbar";
        healthbar.style.width = "200px";
        healthbar.style.height = "30px";
        healthbar.style.left = "20px";
        healthbar.style.top = "50px";
        healthbar.style.zIndex = "1";
        healthbar.style.backgroundColor = "red";
        healthbar.style.borderRadius = "3px";
        healthbar.style.boxShadow = "-5px 5px 0px black";
        healthbar.style.border = "2px solid black";
        healthbar.style.position = "absolute";
        healthbar.style.transition = "all 0.2s";
        healthbar.style.fontFamily = "'VT323', monospace";
        healthbar.style.color = "#000000";

        var innerbar = document.createElement("div");
        innerbar.id = "innerbar";
        innerbar.style.width = healtstatus + "%";
        innerbar.style.height = "100%";
        innerbar.style.backgroundColor = "green";
        healthbar.appendChild(innerbar);
        document.body.appendChild(healthbar);
        return healthbar;
      }
      function displayclientID(clientId) {
        var clientIdElement = document.createElement("div");
        clientIdElement.id = "client-id";
        clientIdElement.textContent = "Client ID: " + clientId;
        clientIdElement.style.fontFamily = "Arial, sans-serif";
        clientIdElement.style.fontSize = "20px";
        clientIdElement.style.color = "black";
        clientIdElement.style.zIndex = "1";
        clientIdElement.style.fontFamily = "'VT323', monospace";
        clientIdElement.style.position = "absolute";
        clientIdElement.style.top = "10px";
        clientIdElement.style.left = "20px";
        document.body.appendChild(clientIdElement);
      }

      function checkCollision() {
        var enemyElement = document.getElementById("enemy");
        var enemyRect = enemyElement.getBoundingClientRect();

        // Die Positionen und Abmessungen des enemy-Elements abrufen
        var enemyTop = enemyRect.top;
        var enemyLeft = enemyRect.left;
        var enemyRight = enemyRect.right;
        var enemyBottom = enemyRect.bottom;

        // Andere Elemente überprüfen
        // Hier kannst du weitere Elemente auswählen und ihre Positionen überprüfen

        // Beispiel: Prüfe, ob enemy mit einem anderen Element mit der ID "obstacle" kollidiert
        var obstacleElement = document.getElementById("cube");
        var obstacleRect = obstacleElement.getBoundingClientRect();
        var obstacleTop = obstacleRect.top;
        var obstacleLeft = obstacleRect.left;
        var obstacleRight = obstacleRect.right;
        var obstacleBottom = obstacleRect.bottom;

        // Kollisionsprüfung durchführen
        if (
          enemyBottom >= obstacleTop &&
          enemyTop <= obstacleBottom &&
          enemyRight >= obstacleLeft &&
          enemyLeft <= obstacleRight
        ) {
          // Kollision erkannt!
          console.log("Kollision mit dem Hindernis!");
        }
      }

      function textBox(text) {
        var textBox = document.createElement("div");
        textBox.id = "box";
        textBox.style.width = "200px";
        textBox.style.height = "350px";
        textBox.style.right = "10px";
        textBox.style.bottom = "10px";
        textBox.style.backgroundColor = "black";
        textBox.style.border = "4px solid #EDC04E";
        textBox.style.borderRadius = "3px";
        textBox.style.padding = "10px";
        textBox.style.position = "absolute";
        textBox.style.fontFamily = "'VT323', monospace";
        textBox.style.color = "white";
        document.body.appendChild(textBox);

        // Textinhalt erstellen und zur Textbox hinzufügen
        var textContent = document.createTextNode(text);
        textBox.appendChild(textContent);
        return textBox;
      }

      function retroBox(text) {
        const box = document.createElement("div");
        box.id = "box";
        box.style.width = "300px";
        box.style.height = "450px";
        box.style.right = "50px";
        box.style.bottom = "50px";
        box.style.padding = "10px";
        box.style.backgroundColor = "#ed3318";
        box.style.border = "2px solid black";
        box.style.boxShadow = "-5px 5px 0px black";
        box.style.position = "absolute";
        box.style.transition = "all 0.2s";
        box.style.fontFamily = "'VT323', monospace";
        box.style.fontSize = "20px";
        box.style.color = "#000000";
        document.body.appendChild(box);

        // Textinhalt erstellen und zur Textbox hinzufügen
        var textContent = document.createTextNode(text);
        box.appendChild(textContent);
        return box;
      }
      function inventar(text) {
        const inbox = document.createElement("div");
        box.id = "box";
        box.style.width = "250px";
        box.style.height = "500px";
        box.style.right = "50px";
        box.style.bottom = "50px";
        box.style.padding = "10px";
        box.style.backgroundColor = "#ed3318";
        box.style.border = "2px solid black";
        box.style.boxShadow = "-5px 5px 0px black";
        box.style.position = "absolute";
        box.style.transition = "all 0.2s";
        box.style.fontFamily = "'VT323', monospace";
        box.style.color = "#000000";
        document.body.appendChild(box);

        // Textinhalt erstellen und zur Textbox hinzufügen
        var inventar = document.createElement("div");
        inventar.id = "inventar";
        inventar.style.width = "50px";
        inventar.style.height = "50px";
        inventar.style.border = "2px solid black";
        inventar.style.backgroundColor = "#ed3318";
        box.appendChild(inventar);
        return box;
      }

      function hideTextBox() {
        var textBox = document.getElementById("box");
        textBox.style.display = "none";
      }

      function body() {
        const body = document.body.style;
        body.margin = "0";
        body.padding = "0";
        body.overflow = "hidden";
        body.width = "100%";
        body.height = "1080px";
      }

      function button() {
        const button = document.createElement("button");
        button.id = "button";
        button.style.width = "50px";
        button.style.height = "50px";
        button.style.right = "50px";
        button.style.bottom = "50px";
        button.style.borderRadius = "100%";
        button.style.padding = "10px";
        button.style.backgroundColor = "#ed3318";
        button.style.border = "2px solid black";
        button.style.boxShadow = "-5px 5px 0px black";
        button.style.position = "absolute";
        button.style.fontFamily = "'VT323', monospace";
        button.style.color = "#000000";
        document.body.appendChild(button);

        // Hinzufügen eines Klick-Eventhandlers zum Button
        button.addEventListener("click", () => {
          alert("Button wurde geklickt!");
        });
      }

      function playground(height = 1000, player) {
        const playground = document.createElement("div");
        document.body.style.margin = "0";
        document.body.style.padding = "0";
        document.body.style.overflow = "hidden";
        document.body.style.width = "100%";
        document.body.style.height = "1090px";
        document.body.style.backgroundColor = "white";

        playground.id = "playground";
        playground.style.width = "100%";
        playground.style.height = height + "px";
        playground.style.backgroundColor = "pink";
        playground.appendChild(player);
        document.body.appendChild(playground);
        //playground = document.body.appendChild(clientIdElement);
        return playground;
      }

      function checkCollision(object) {
        if (
          this.x < object.x + object.width &&
          this.x + this.width > object.x &&
          this.y < object.y + object.height &&
          this.y + this.height > object.y
        ) {
          console.log("Kollision");
          // Kollision erkannt
          return true;
        }
        console.log("Keine Kollision");
        // Keine Kollision
        return false;
      }

      function getRandomIntInclusive(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1) + min); // The maximum is inclusive and the minimum is inclusive
      }

      function divHandler(keyCode, divElement) {
        retroBoxElement = divElement;
        keyPressCount++;

        if (keyPressCount === 1) {
          if (!retroBoxElement) {
            retroBoxElement = divElement;
          } else {
            retroBoxElement.style.display = "block";
          }
        } else if (keyPressCount === 2) {
          if (retroBoxElement) {
            retroBoxElement.style.display = "none";
          }
          keyPressCount = 0;
        }
      }
    </script>
  </body>
</html>
